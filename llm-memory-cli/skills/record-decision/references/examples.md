# Record Decision - ä½¿ç”¨ç¤ºä¾‹

## ç¤ºä¾‹ 1ï¼šæŠ€æœ¯æ–¹æ¡ˆé€‰å‹

### åœºæ™¯

å›¢é˜Ÿè®¨è®ºè®¤è¯æ–¹æ¡ˆï¼Œæœ€ç»ˆé€‰æ‹© JWT

### å¯¹è¯è¿‡ç¨‹

```
ç”¨æˆ·ï¼šæˆ‘ä»¬éœ€è¦é€‰æ‹©è®¤è¯æ–¹æ¡ˆï¼ŒJWT è¿˜æ˜¯ Sessionï¼Ÿ

åŠ©æ‰‹ï¼šè®©æˆ‘ä»¬å¯¹æ¯”ä¸€ä¸‹ä¸¤ä¸ªæ–¹æ¡ˆ...
[è¯¦ç»†è®¨è®ºè¿‡ç¨‹]

åŠ©æ‰‹ï¼šåŸºäºä»¥ä¸Šåˆ†æï¼Œå»ºè®®é€‰æ‹© JWT + Refresh Token æ–¹æ¡ˆã€‚

ç”¨æˆ·ï¼šå¥½çš„ï¼Œå°±ç”¨è¿™ä¸ªæ–¹æ¡ˆã€‚
```

### æ‰§è¡Œè®°å½•

```bash
llm-memory memory create mem-jwt-vs-session \
  --title "JWT vs Session è®¤è¯æ–¹æ¡ˆé€‰å‹" \
  --category "æ¶æ„å†³ç­–" \
  --tags "auth,jwt,security,architecture" \
  --priority 3 \
  --content "$(cat <<'EOF'
# JWT vs Session è®¤è¯æ–¹æ¡ˆé€‰å‹

## èƒŒæ™¯
éœ€è¦ä¸ºæ–°çš„ç”¨æˆ·è®¤è¯ç³»ç»Ÿé€‰æ‹©åˆé€‚çš„è®¤è¯æ–¹æ¡ˆã€‚

## å€™é€‰æ–¹æ¡ˆ

### æ–¹æ¡ˆ 1: JWT (JSON Web Token)
- **ä¼˜ç‚¹**ï¼š
  - æ— çŠ¶æ€ï¼ŒæœåŠ¡å™¨æ— éœ€å­˜å‚¨ä¼šè¯
  - æ˜“äºæ°´å¹³æ‰©å±•
  - è·¨åŸŸå‹å¥½
  - ç§»åŠ¨ç«¯å‹å¥½
- **ç¼ºç‚¹**ï¼š
  - æ— æ³•ä¸»åŠ¨å¤±æ•ˆ
  - Token ä½“ç§¯è¾ƒå¤§
  - éœ€è¦å¤„ç† Token åˆ·æ–°

### æ–¹æ¡ˆ 2: Session
- **ä¼˜ç‚¹**ï¼š
  - å¯ä¸»åŠ¨å¤±æ•ˆ
  - å®‰å…¨æ€§é«˜
  - å®ç°ç®€å•
- **ç¼ºç‚¹**ï¼š
  - éœ€è¦æœåŠ¡å™¨å­˜å‚¨
  - æ‰©å±•å›°éš¾
  - è·¨åŸŸéº»çƒ¦

## æœ€ç»ˆå†³ç­–
é€‰æ‹© JWT + Refresh Token æ–¹æ¡ˆ

## ç†ç”±
1. ç³»ç»Ÿéœ€è¦æ”¯æŒæ°´å¹³æ‰©å±•
2. éœ€è¦åŒæ—¶æ”¯æŒç§»åŠ¨ç«¯å’Œ Web ç«¯
3. ä½¿ç”¨ Refresh Token æœºåˆ¶è§£å†³æ— æ³•ä¸»åŠ¨å¤±æ•ˆçš„é—®é¢˜
4. é€šè¿‡ Token é»‘åå•å¤„ç†æ³¨é”€åœºæ™¯

## å½±å“
- éœ€è¦å®ç° Token é»‘åå•æœºåˆ¶
- éœ€è¦è®¾è®¡ Refresh Token å­˜å‚¨æ–¹æ¡ˆï¼ˆRedisï¼‰
- å‰ç«¯éœ€è¦å¤„ç† Token åˆ·æ–°é€»è¾‘

## å‚è€ƒèµ„æ–™
- [JWT æœ€ä½³å®è·µ](https://datatracker.ietf.org/doc/html/rfc7519)
- [OAuth 2.0 è§„èŒƒ](https://oauth.net/2/)
EOF
)"
```

### è¾“å‡º

```
âœ… è®°å¿†åˆ›å»ºæˆåŠŸ

Code: mem-jwt-vs-session
æ ‡é¢˜: JWT vs Session è®¤è¯æ–¹æ¡ˆé€‰å‹
åˆ†ç±»: æ¶æ„å†³ç­–
æ ‡ç­¾: auth, jwt, security, architecture
ä¼˜å…ˆçº§: 3 (é«˜)
ä½œç”¨åŸŸ: é¡¹ç›®
```

---

## ç¤ºä¾‹ 2ï¼šå¤æ‚ Bug æ’æŸ¥

### åœºæ™¯

ç”Ÿäº§ç¯å¢ƒå†…å­˜æ³„æ¼ï¼Œæ’æŸ¥ 2 å°æ—¶åæ‰¾åˆ°åŸå› 

### å¯¹è¯è¿‡ç¨‹

```
ç”¨æˆ·ï¼šç”Ÿäº§ç¯å¢ƒå†…å­˜ä¸€ç›´åœ¨æ¶¨ï¼Œå·²ç»å´©æºƒäº†ä¸¤æ¬¡

åŠ©æ‰‹ï¼šè®©æˆ‘å¸®ä½ åˆ†æä¸€ä¸‹...
[æ’æŸ¥è¿‡ç¨‹]

ç”¨æˆ·ï¼šç»ˆäºæ‰¾åˆ°äº†ï¼æ˜¯ WebSocket æ–­å¼€é‡è¿æ—¶æ²¡æœ‰æ¸…ç†æ—§çš„ç›‘å¬å™¨

åŠ©æ‰‹ï¼šç¡®è®¤æ˜¯è¿™ä¸ªåŸå› ã€‚è®©æˆ‘è®°å½•ä¸‹è¿™æ¬¡æ’æŸ¥è¿‡ç¨‹ã€‚
```

### æ‰§è¡Œè®°å½•

```bash
llm-memory memory create mem-memory-leak-websocket \
  --title "WebSocket å†…å­˜æ³„æ¼é—®é¢˜æ’æŸ¥ä¸è§£å†³" \
  --category "é—®é¢˜æ’æŸ¥" \
  --tags "bug,memory-leak,nodejs,websocket,production" \
  --priority 4 \
  --content "$(cat <<'EOF'
# WebSocket å†…å­˜æ³„æ¼é—®é¢˜æ’æŸ¥ä¸è§£å†³

## èƒŒæ™¯
ç”Ÿäº§ç¯å¢ƒå‡ºç°å†…å­˜æŒç»­å¢é•¿é—®é¢˜ï¼Œæœ€ç»ˆå¯¼è‡´ OOM å´©æºƒã€‚
- é¦–æ¬¡å‘ç°æ—¶é—´ï¼š2024-12-01 10:00
- å½±å“èŒƒå›´ï¼šæ‰€æœ‰ WebSocket è¿æ¥çš„ç”¨æˆ·
- å´©æºƒæ¬¡æ•°ï¼š2 æ¬¡

## æ’æŸ¥è¿‡ç¨‹

### 1. æ”¶é›†å†…å­˜å¿«ç…§
ä½¿ç”¨ heapdump åœ¨ä¸åŒæ—¶é—´ç‚¹è·å–å†…å­˜å¿«ç…§

### 2. åˆ†æå†…å­˜å¢é•¿
å¯¹æ¯”å¤šä¸ªå¿«ç…§ï¼Œå‘ç° EventEmitter ç›‘å¬å™¨æ•°é‡æŒç»­å¢é•¿

### 3. å®šä½é—®é¢˜ä»£ç 
è¿½è¸ªåˆ° WebSocket è¿æ¥ç®¡ç†æ¨¡å—

### 4. ç¡®è®¤æ ¹å› 
WebSocket æ–­å¼€é‡è¿æ—¶ï¼Œæ—§çš„äº‹ä»¶ç›‘å¬å™¨æ²¡æœ‰è¢«ç§»é™¤

## æ ¹æœ¬åŸå› 
```javascript
// é—®é¢˜ä»£ç 
socket.on('disconnect', () => {
  // é‡è¿é€»è¾‘ï¼Œä½†æ²¡æœ‰æ¸…ç†æ—§ç›‘å¬å™¨
  socket.connect();
});
```

æ¯æ¬¡é‡è¿éƒ½ä¼šæ·»åŠ æ–°çš„ç›‘å¬å™¨ï¼Œå¯¼è‡´å†…å­˜æ³„æ¼ã€‚

## è§£å†³æ–¹æ¡ˆ
```javascript
// ä¿®å¤å
socket.on('disconnect', () => {
  socket.removeAllListeners();  // å…ˆæ¸…ç†
  socket.connect();
});
```

## é¢„é˜²æªæ–½
1. æ·»åŠ  EventEmitter ç›‘å¬å™¨æ•°é‡ç›‘æ§å‘Šè­¦
2. ä»£ç  Review æ£€æŸ¥ç‚¹å¢åŠ äº‹ä»¶ç›‘å¬æ¸…ç†
3. å¢åŠ å†…å­˜ä½¿ç”¨ç‡ç›‘æ§å’Œå‘Šè­¦

## ç›¸å…³ä»£ç 
- æ–‡ä»¶ï¼šsrc/services/websocket.js
- ä¿®å¤ PRï¼š#1234
EOF
)"
```

---

## ç¤ºä¾‹ 3ï¼šè§„èŒƒåˆ¶å®š

### åœºæ™¯

å›¢é˜Ÿç»Ÿä¸€ API å“åº”æ ¼å¼

### å¯¹è¯è¿‡ç¨‹

```
ç”¨æˆ·ï¼šæˆ‘ä»¬éœ€è¦ç»Ÿä¸€ API å“åº”æ ¼å¼

åŠ©æ‰‹ï¼šå¥½çš„ï¼Œè®©æˆ‘ä»¬å®šä¹‰ä¸€ä¸ªæ ‡å‡†æ ¼å¼...

ç”¨æˆ·ï¼šå°±ç”¨ { code, data, message, timestamp } è¿™ä¸ªç»“æ„
```

### æ‰§è¡Œè®°å½•

```bash
llm-memory memory create mem-api-response-format \
  --title "API å“åº”æ ¼å¼è§„èŒƒ" \
  --category "è®¾è®¡è§„èŒƒ" \
  --tags "api,convention,backend" \
  --priority 3 \
  --global \
  --content "$(cat <<'EOF'
# API å“åº”æ ¼å¼è§„èŒƒ

## æ ‡å‡†å“åº”ç»“æ„

```typescript
interface ApiResponse<T> {
  code: number;      // ä¸šåŠ¡çŠ¶æ€ç 
  data: T | null;    // å“åº”æ•°æ®
  message: string;   // æç¤ºä¿¡æ¯
  timestamp: number; // å“åº”æ—¶é—´æˆ³
}
```

## çŠ¶æ€ç å®šä¹‰

| èŒƒå›´ | è¯´æ˜ |
|------|------|
| 0 | æˆåŠŸ |
| 1xxx | å®¢æˆ·ç«¯é”™è¯¯ï¼ˆå‚æ•°ã€æƒé™ç­‰ï¼‰|
| 2xxx | æœåŠ¡ç«¯é”™è¯¯ï¼ˆå†…éƒ¨é”™è¯¯ï¼‰|
| 3xxx | ç¬¬ä¸‰æ–¹æœåŠ¡é”™è¯¯ |

## ç¤ºä¾‹

### æˆåŠŸå“åº”
```json
{
  "code": 0,
  "data": { "id": 1, "name": "å¼ ä¸‰" },
  "message": "success",
  "timestamp": 1701408000000
}
```

### é”™è¯¯å“åº”
```json
{
  "code": 1001,
  "data": null,
  "message": "ç”¨æˆ·åå·²å­˜åœ¨",
  "timestamp": 1701408000000
}
```

## é€‚ç”¨èŒƒå›´
- æ‰€æœ‰ REST API æ¥å£
- ä¸åŒ…æ‹¬æ–‡ä»¶ä¸‹è½½ç­‰ç‰¹æ®Šæ¥å£
EOF
)"
```

---

## ç¤ºä¾‹ 4ï¼šæ‰‹åŠ¨è§¦å‘

### åœºæ™¯

ç”¨æˆ·æ˜ç¡®è¦æ±‚è®°å½•å†³ç­–

### å¯¹è¯è¿‡ç¨‹

```
ç”¨æˆ·ï¼šè®°å½•è¿™ä¸ªå†³ç­–ï¼Œæˆ‘ä»¬å†³å®šä½¿ç”¨ PostgreSQL ä½œä¸ºä¸»æ•°æ®åº“ï¼Œå› ä¸ºéœ€è¦å¤æ‚æŸ¥è¯¢å’Œäº‹åŠ¡æ”¯æŒ
```

### æ‰§è¡Œè®°å½•

```bash
llm-memory memory create mem-postgresql-selection \
  --title "PostgreSQL æ•°æ®åº“é€‰å‹" \
  --category "æ¶æ„å†³ç­–" \
  --tags "database,postgresql,architecture" \
  --priority 3 \
  --content "$(cat <<'EOF'
# PostgreSQL æ•°æ®åº“é€‰å‹

## å†³ç­–
é€‰æ‹© PostgreSQL ä½œä¸ºä¸»æ•°æ®åº“

## ç†ç”±
1. éœ€è¦æ”¯æŒå¤æ‚æŸ¥è¯¢ï¼ˆJOINã€å­æŸ¥è¯¢ç­‰ï¼‰
2. éœ€è¦å®Œæ•´çš„äº‹åŠ¡æ”¯æŒï¼ˆACIDï¼‰
3. éœ€è¦æ”¯æŒ JSON æ•°æ®ç±»å‹
4. å›¢é˜Ÿæœ‰ PostgreSQL ä½¿ç”¨ç»éªŒ

## å¤‡é€‰æ–¹æ¡ˆ
- MySQLï¼šä¸é€‰æ‹©ï¼Œå› ä¸º JSON æ”¯æŒä¸å¤Ÿå¥½
- MongoDBï¼šä¸é€‰æ‹©ï¼Œå› ä¸ºéœ€è¦äº‹åŠ¡æ”¯æŒ
EOF
)"
```

---

## å¿«æ·è„šæœ¬

### record-decision.sh

```bash
#!/bin/bash
# å¿«é€Ÿè®°å½•å†³ç­–

echo "ğŸ“ è®°å½•å†³ç­–"
echo ""

read -p "Code (mem-xxx): " CODE
read -p "æ ‡é¢˜: " TITLE
read -p "åˆ†ç±» (æ¶æ„å†³ç­–/é—®é¢˜æ’æŸ¥/è®¾è®¡è§„èŒƒ/æœ€ä½³å®è·µ): " CATEGORY
read -p "æ ‡ç­¾ (é€—å·åˆ†éš”): " TAGS
read -p "ä¼˜å…ˆçº§ (1-4): " PRIORITY
read -p "å…¨å±€å¯è§? (y/n): " GLOBAL

echo "è¯·è¾“å…¥å†…å®¹ (Ctrl+D ç»“æŸ):"
CONTENT=$(cat)

CMD="llm-memory memory create $CODE --title \"$TITLE\" --category \"$CATEGORY\" --tags \"$TAGS\" --priority $PRIORITY"

if [[ "$GLOBAL" =~ ^[Yy]$ ]]; then
  CMD="$CMD --global"
fi

echo ""
echo "æ‰§è¡Œå‘½ä»¤:"
echo "$CMD --content \"...\""
echo ""

eval "$CMD --content \"\$CONTENT\""
```
